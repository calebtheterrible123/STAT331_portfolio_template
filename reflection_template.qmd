---
title: "STAT 331 Portfolio"
author: "Caleb Terrell"
format: html 
embed-resources: true
layout: margin-left
editor: visual
execute: 
  eval: false
  echo: true
---

[**My Grade:**]{.underline} I believe my grade equivalent to course work evidenced below to be an B-.

[**Learning Objective Evidence:**]{.underline} In the code chunks below, provide code from Lab or Challenge assignments where you believe you have demonstrated proficiency with the specified learning target. Be sure to specify **where** the code came from (e.g., Lab 4 Question 2).

## Working with Data

**WD-1: I can import data from a *variety* of formats (e.g., csv, xlsx, txt, etc.).**

-   `csv` Example 1

```{r}
#| label: CSV Example 1 
# Lab 9 q 1
surveys <- read_csv(here("surveys.csv"))

evals <- read_csv(here("teacher_evals.csv")) |>
  rename(sex = gender)

fish <- read_csv(here("BlackfootFish.csv")) 
```

-   `csv` Example 2

```{r}
#| label: CSV example 2 
# Lab 4 q 2
data <- read_csv(here("teacher_evals.csv"))  
```

-   `xlsx`

```{r}
#| label:  XLSX 
# PA 4 q 1
military <- read_xlsx("gov_spending_per_capita.xlsx",
                      sheet = "Share of Govt. spending",
                      skip  = 7,
                      n_max = 190,
                      na = c(". .", "xxx", ". . ")

                      )
```

**WD-2: I can select necessary columns from a data set.**

-   Example selecting specified columns

```{r}
#| label: wd-2-ex-1
# Lab 3 Q 5 
teacher_evals_clean <- data %>%
  rename(sex = gender) %>% 
  
  filter(no_participants >= 10) %>%
  
  mutate(
    teacher_id = as.character(teacher_id), 
    course_id  = as.character(course_id),
    sex = as.factor(sex),
    academic_degree = as.factor(academic_degree),
    seniority = as.integer(seniority)
  ) %>%
  
  select(course_id, teacher_id, question_no, no_participants, resp_share,
         SET_score_avg, percent_failed_cur, academic_degree, seniority, sex)

glimpse(teacher_evals_clean)

```

-   Example removing specified columns STAR

```{r}
#| label: wd-2-ex-2
# Lab 7 Q 2 
pivot_missing <- missing_summary |>
  select(-observations_with_missing) |> 
  pivot_longer(
    cols = everything(),
    names_to = "variable",
    values_to = "missing_values"
  )
```

-   Example selecting columns based on logical values (e.g., `starts_with()`, `ends_with()`, `contains()`, `where()`) STAR

```{r}
#| label: wd-2-ex-3
# Lab 4 Q7
childcare_long <- ca_childcare |>
  select(region, study_year, mfcc_infant, mfcc_toddler, mfcc_preschool) |>
  pivot_longer(
    cols = starts_with("mfcc_"),
    names_to = "care_type",
    values_to = "median_price"
  )

```

**WD-3: I can filter rows from a data frame for a *variety* of data types (e.g., numeric, integer, character, factor, date).**

-   Numeric Example 1

```{r}
#| label: wd-3-numeric-ex-1
# Lab 7
fish_missing <- fish |>
  filter(is.na(weight) | weight < 0)

```

-   Numeric Example 2

```{r}
#| label: wd-3-numeric-ex-1
# Lab 3 Q 5 
teacher_evals_clean <- data %>%
  rename(sex = gender) %>%
  
  filter(no_participants >= 10) %>%
  
  mutate(
    teacher_id = as.character(teacher_id), 
    course_id  = as.character(course_id),
    sex = as.factor(sex),
    academic_degree = as.factor(academic_degree),
    seniority = as.integer(seniority)
  ) %>%
  
  select(course_id, teacher_id, question_no, no_participants, resp_share,
         SET_score_avg, percent_failed_cur, academic_degree, seniority, sex)

```

-   Character Example 1 (any context)

```{r}
#| label: wd-3-character
# Lab 4, Question 2
ca_childcare <- counties |>
  filter(state_abbreviation == "CA") |>  
  inner_join(childcare_costs, by = "county_fips_code")

```

-   Character Example 2 (example must use functions from **stringr**)

```{r}
#| label: wd-3-string
# Lab 5 
witnesses <- person |>
  filter(
    str_detect(address_street_name, "Northwestern") |
    str_detect(address_street_name, "Franklin") |
    str_detect(name, "Ann")
  )

```

-   Date (example must use functions from **lubridate**)

```{r}
#| label: wd-3-date
# Lab 5 (revised)
crime_2018_0115 <- crime_scene_report |>
  mutate(date = lubridate::ymd(date)) |>
  filter(city == "SQL City", date == ymd("2018-01-15"))
```

**WD-4: I can modify existing variables and create new variables in a dataframe for a *variety* of data types (e.g., numeric, integer, character, factor, date).**

-   Numeric Example 1

```{r}
#| label: wd-4-numeric-ex-1
# Lab 4 Q 5 
summarize(
  median_income = median(mhi_2018, na.rm = TRUE),
  .groups = "drop"
)
```

-   Numeric Example 2

```{r}
#| label: wd-4-numeric-ex-2
# Lab 7 q 3
missing_by_group <- fish |>
  group_by(year, section, trip) |>
  summarize(
    missing_count = sum(is.na(weight)),
    .groups = "drop"
  ) |>
  mutate(trip = if_else(trip == 1, "Trip 1", "Trip 2"))

```

-   Factor Example 1 (renaming levels)

```{r}
#| label: wd-4-factor-ex-1
# Lab 4 Q 7 

childcare_plot_data <- ca_childcare |>
  select(c("region", "study_year", "mfcc_infant", "mfcc_toddler", "mfcc_preschool")) |>
  pivot_longer(
    cols = starts_with("mfcc_"),
    names_to = "care_type",
    values_to = "cost"
  ) |>
  mutate(
    care_type = recode(care_type,
                       mfcc_infant = "Infant",
                       mfcc_toddler = "Toddler",
                       mfcc_preschool = "Preschool"),
    care_type = factor(care_type, levels = c("Infant", "Toddler", "Preschool")),
    region = fct_reorder2(region, study_year, cost, .desc = TRUE)
  )

region_colors <- colorRampPalette(brewer.pal(7, "Accent"))(10)

childcare_plot_data |> ggplot(mapping = aes(x = study_year,
                                            y = cost,
                                            color = region)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  facet_wrap(~ care_type) +
  scale_x_continuous(
    breaks = seq(2008, 2018, by = 2),
    minor_breaks = 2008:2018
  ) +
  coord_cartesian(ylim = c(100, 350)) +
  scale_color_manual(values = region_colors) +
  labs(
    x = "Study Year",
    y = "",
    title = "Weekly Median Price for Center-Based Childcare ($)",
    color = "California Region"
  ) +
  theme_bw() +
  theme(
    legend.key.size = unit(0.9, "lines"),
    legend.text = element_text(size = 8),
    legend.title = element_text(size = 10),
    plot.title = element_text(size = 10),
    panel.spacing = unit(0.7, "lines")
  )

```

-   Factor Example 2 (reordering levels)

```{r}
#| label: wd-4-factor-ex-2
# Lab 4 Q 4
ca_childcare <- ca_childcare |>
  mutate(
    county_name = str_remove(county_name, " County"),
    region = case_when(
      county_name %in% superior_counties ~ "Superior California",
      county_name %in% north_coast_counties ~ "North Coast",
      county_name %in% san_fran_counties ~ "San Francisco, Bay Area",
      county_name %in% n_san_joaquin_counties ~ "Northern San Joaquin Valley",
      county_name %in% central_coast_counties ~ "Central Coast",
      county_name %in% s_san_joaquin_counties ~ "Southern San Joaquin Valley",
      county_name %in% inland_counties ~ "Inland Empire",
      county_name %in% la_county ~ "Los Angeles",
      county_name %in% orange_county ~ "Orange County",
      county_name %in% san_diego_imperial_counties ~ "San Diego Imperial",
      TRUE ~ NA_character_
    ),
    region = fct_relevel(region,
      "Superior California",
      "North Coast",
      "San Francisco, Bay Area",
      "Northern San Joaquin Valley",
      "Central Coast",
      "Southern San Joaquin Valley",
      "Inland Empire",
      "Los Angeles",
      "Orange County",
      "San Diego Imperial"
    )
  )
```

-   Character (example must use functions from **stringr**)

```{r}
#| label: wd-4-string
# Lab 5
witnesses <- person |>
  filter(
    str_detect(address_street_name, "Northwestern") |
    str_detect(address_street_name, "Franklin") |
    str_detect(name, "Ann")
  ) |>
  select(id, name, address_number, address_street_name)

witness_interviews <- interview |>
  filter(person_id %in% witnesses$id) |>
  select(person_id, transcript)

witness_interviews


-   Date (example must use functions from **lubridate**)

#| label: wd-4-date
# lab 5 
crime_scene_report |>
  mutate(date = ymd(date)) |>
  filter(date == ymd("2018-01-15"))

```

**WD-5: I can use mutating joins to combine multiple dataframes.**

-   `left_join()` Example 1

```{r}
#| label: wd-5-left-ex-1
# lab 4 q 3
ca_childcare <- ca_childcare |>
  left_join(
    tax_rev,
    by = join_by(county_name == entity_name, study_year == year)
  )

```

-   `right_join()` Example 1

```{r}
#| label: wd-5-right
# Lab 4 q2 (edited)
ca_childcare <- childcare_costs_raw |>
  right_join(counties, by = "county_fips_code")
```

-   `left_join()` **or** `right_join()` Example 2

```{r}
#| label: wd-5-left-right-ex-2
# lab 5
gym_people <- get_fit_now_member |>
  left_join(person, by = c("person_id" = "id"))
```

-   `inner_join()` Example 1

```{r}
#| label: wd-5-inner-ex-1
# Lab 5
gym_people <- get_fit_now_member |>
  inner_join(person, by = c("person_id" = "id"))
gym_people_clean <- gym_people |>
  select(
    person_id,
    membership_id = id,
    gym_name = name.x,
    person_name = name.y,
    membership_status
  )
gym_people_clean |> head(10)
```

-   `inner_join()` Example 2

```{r}
#| label: wd-5-inner-ex-2
# Lab 5 
gym_suspects <- get_fit_now_member |>
  filter(str_detect(id, "^48Z"), membership_status == "gold") |>
  inner_join(person, by = c("person_id" = "id")) |>
  select(person_id, name = name.y, membership_id = id, membership_status) 
```

**WD-6: I can use filtering joins to filter rows from a dataframe.** - `semi_join()`

```{r}
#| label: wd-6-semi
# lab 5 (edited)
gym_members <- get_fit_now_member |>
  filter(membership_status == "gold")
people_in_gym <- person |>
  semi_join(gym_members, by = c("id" = "person_id")) |>
  select(id, name, address_number, address_street_name)
```

-   `anti_join()`

```{r}
#| label: wd-6-anti
# Lab 5 (revised)
people_no_license <- person |> 
  anti_join(drivers_license, by = c("license_id" = "id"))

people_no_license
```

**WD-7: I can pivot dataframes from long to wide and visa versa**

-   `pivot_longer()`

```{r}
#| label: wd-7-long
# Lab 7 q 2
pivot_missing <- missing_summary |>
  select(-observations_with_missing) |>     
  pivot_longer(
    cols = everything(),                 
    names_to = "variable",                 
    values_to = "missing_values"           
  )
```

-   `pivot_wider()`

```{r}
#| label: wd-7-wide
# lab 8 q 2
pivot_table <- function(data_in, row_var, col_var) {

  if (!is.data.frame(data_in)) {
    stop("data_in needs to be a data frame.")
  }

  data_in |>
    dplyr::count({{ row_var }}, {{ col_var }}) |>
    tidyr::pivot_wider(
      names_from  = {{ col_var }},
      values_from = n,
      values_fill = 0
    ) |>
    janitor::adorn_totals(c("row", "col"))
}
```

## Reproducibility

**R-1: I can create professional looking, reproducible analyses using RStudio projects, Quarto documents, and the here package.**

The following assignments satisfy the above criteria:

-   Lab 7

-   Lab 10

-   Challenge 7

-   Lab 8

-   Lab 9.

For much of this class, I did not have my folders set up on my computer correctly, therefore my overall reading in of functions was done in a way that did not satisfy this course's requirements. Lab 8 & 7 although read in my code, are done from a different approach then this class's requirements. I still want to include them to show not only how I grew from them (especially in lab 9 & 10) but also how I had other creative ways of using my knowledge from class and outside research to do my assignments (all outside reasearch was tagged with a link under a \# with the code I used the websites on)

**R-2: I can write well documented and tidy code.**

-   Example of **ggplot2** plotting

```{r}
#| label: r-2-1
# Lab 7 q 3
missing_by_group <- fish |>
  group_by(year, section, trip) |>
  summarize(
    missing_count = sum(is.na(weight)),
    .groups = "drop"
  ) |>
  mutate(trip = if_else(trip == 1, "Trip 1", "Trip 2"))

ggplot(missing_by_group, aes(x = year, y = missing_count, color = section)) +
  geom_line(size = 1) +
  scale_color_brewer(palette = "Set2") +
  facet_wrap(~ trip) +
  labs(
    title = "Missing Fish Weights Across Years, Sections, and Trips",
    x = "Year",
    y = "Count of Missing Weights",
    color = "Section"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

```

-   Example of **dplyr** pipeline

```{r}
#| label: r-2-2
# Lab 3 q 5
teacher_evals_clean <- data %>%
  rename(sex = gender) %>%
  filter(no_participants >= 10) %>%
  mutate(
    teacher_id = as.character(teacher_id),
    course_id  = as.character(course_id),
    sex = as.factor(sex),
    academic_degree = as.factor(academic_degree),
    seniority = as.integer(seniority)
  ) %>%
  select(
    course_id, teacher_id, question_no, no_participants, resp_share,
    SET_score_avg, percent_failed_cur, academic_degree, seniority, sex
  )
```

-   Example of function formatting

```{r}
#| label: r-2-3
# Lab 7 q 4
rescale_01 <- function(x) {
  if (!is.numeric(x)) {
    stop("input is not numeric.")
  }
  if (length(x) <= 1) {
    stop("needs more then one variable")
  }
  
  rng <- range(x, na.rm = TRUE)
  
  (x - rng[1]) / (rng[2] - rng[1])
}

```

**R-3: I can write robust programs that are resistant to changes in inputs.**

-   Example (any context)

```{r}
#| label: r-3-example
# Lab 7 q 4
mycifun <- function(beta0, beta1, n) {

  x  <- runif(n, min = 0, max = 1)
  ep <- rnorm(n, mean = 0, sd = 1)
  y  <- beta0 + beta1 * x + ep
  
  obs_data <- tibble(x = x, y = y)

  fit <- lm(y ~ x, data = obs_data)

  slope_results <- tidy(fit, conf.int = TRUE)

  slope_results <- slope_results |>
    filter(term == "x") |>
    mutate(
      cover = ifelse(beta1 >= conf.low & beta1 <= conf.high, 1, 0)
    ) |>
    select(estimate, conf.low, conf.high, cover)

  return(slope_results)
}
```

-   Example (function stops)

```{r}
#| label: r-3-function-stops
# Lab 7 q 5 
rescale_01 <- function(x) {
  if (!is.numeric(x)) {
    stop("input is not numeric.")
  }
  if (length(x) <= 1) {
    stop("needs more then one variable")
  }
  
  rng <- range(x, na.rm = TRUE)
  
  (x - rng[1]) / (rng[2] - rng[1])
}
```

## Data Visualization & Summarization

**DVS-1: I can create visualizations for a *variety* of variable types (e.g., numeric, character, factor, date)**

-   At least two numeric variables

```{r}
#| label: dvs-1-num
# lab 7 q 3
missing_by_group <- fish |>
  group_by(year, section, trip) |>
  summarize(
    missing_count = sum(is.na(weight)),
    .groups = "drop"
  ) |>
  mutate(trip = if_else(trip == 1, "Trip 1", "Trip 2"))

ggplot(missing_by_group, aes(x = year, y = missing_count, color = section)) +
  geom_line(size = 1) +
  scale_color_brewer(palette = "Set2") +
  facet_wrap(~ trip) +
  labs(
    title = "Missing Fish Weights Across Years, Sections, and Trips",
    x = "Year",
    y = "Count of Missing Weights",
    color = "Section"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

-   At least one numeric variable and one categorical variable

```{r}
#| label: dvs-2-num-cat
# Challenge 3 q 2 
ggplot(teacher_evals_compare, aes(x = sen_level, fill = SET_level)) +
  geom_bar(position = "fill") + 
  labs(
    title = "Evaluation of Teachers' Use of Activities",
    x = "years of experience",
    y = "proportion",
    fill = "evaluation rating"
  ) +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal()
```

-   At least two categorical variables

```{r}
#| label: dvs-2-cat
# Lab 7 q3
missing_by_group <- fish |>
  group_by(year, section, trip) |>
  summarize(
    missing_count = sum(is.na(weight)),
    .groups = "drop"
  ) |>
  mutate(trip = if_else(trip == 1, "Trip 1", "Trip 2"))

ggplot(missing_by_group, aes(x = year, y = missing_count, color = section)) +
  geom_line(size = 1) +
  scale_color_brewer(palette = "Set2") +
  facet_wrap(~ trip) +
  labs(
    title = "Missing Fish Weights Across Years, Sections, and Trips",
    x = "Year",
    y = "Count of Missing Weights",
    color = "Section"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

-   Dates (time series plot)

```{r}
#| label: dvs-2-date
# lab 4 Q 7
library(RColorBrewer)

childcare_plot_data <- ca_childcare |>
  select(c("region", "study_year", "mfcc_infant", "mfcc_toddler", "mfcc_preschool")) |>
  pivot_longer(
    cols = starts_with("mfcc_"),
    names_to = "care_type",
    values_to = "cost"
  ) |>
  mutate(
    care_type = recode(care_type,
                       mfcc_infant = "Infant",
                       mfcc_toddler = "Toddler",
                       mfcc_preschool = "Preschool"),
    care_type = factor(care_type, levels = c("Infant", "Toddler", "Preschool")),
    region = fct_reorder2(region, study_year, cost, .desc = TRUE)
  )

region_colors <- colorRampPalette(brewer.pal(7, "Accent"))(10)

childcare_plot_data |> ggplot(mapping = aes(x = study_year,
                                            y = cost,
                                            color = region)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  facet_wrap(~ care_type) +
  scale_x_continuous(
    breaks = seq(2008, 2018, by = 2),
    minor_breaks = 2008:2018
  ) +
  coord_cartesian(ylim = c(100, 350)) +
  scale_color_manual(values = region_colors) +
  labs(
    x = "Study Year",
    y = "",
    title = "Weekly Median Price for Center-Based Childcare ($)",
    color = "California Region"
  ) +
  theme_bw() +
  theme(
    legend.key.size = unit(0.9, "lines"),
    legend.text = element_text(size = 8),
    legend.title = element_text(size = 10),
    plot.title = element_text(size = 10),
    panel.spacing = unit(0.7, "lines")
  )
```

**DVS-2: I use plot modifications to make my visualization clear to the reader.**

-   I can modify my plot theme to be more readable

```{r}
#| label: dvs-2-ex-1
# Lab 7 q 6
ggplot(missing_by_group, aes(x = year, y = missing_count, color = section)) +
  geom_line(size = 1) +
  scale_color_brewer(palette = "Set2") +
  facet_wrap(~ trip) +
  labs(
    title = "Missing Fish Weights Across Years, Sections, and Trips",
    x = "Year",
    y = "Count of Missing Weights",
    color = "Section"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

```

-   I can modify my colors to be accessible to anyone's eyes

```{r}
#| label: dvs-2-ex-2
# Lab 8 q 4
my_plot <- ggplot(penguins, aes(x = species, fill = sex)) +
  geom_bar()

style_plot(
  my_plot,
  theme_fn = theme_bw(),                 
  colors = brewer.pal(3, "Dark2"),       
  aesthetic = "fill"                      
)

```

-   I can modify my plot titles to clearly communicate the data context

```{r}
#| label: dvs-2-ex-3
# lab 4 q 7
childcare_plot_data <- ca_childcare |>
  select(c("region", "study_year", "mfcc_infant", "mfcc_toddler", "mfcc_preschool")) |>
  pivot_longer(
    cols = starts_with("mfcc_"),
    names_to = "care_type",
    values_to = "cost"
  ) |>
  mutate(
    care_type = recode(care_type,
                       mfcc_infant = "Infant",
                       mfcc_toddler = "Toddler",
                       mfcc_preschool = "Preschool"),
    care_type = factor(care_type, levels = c("Infant", "Toddler", "Preschool")),
    region = fct_reorder2(region, study_year, cost, .desc = TRUE)
  )

region_colors <- colorRampPalette(brewer.pal(7, "Accent"))(10)

childcare_plot_data |> ggplot(mapping = aes(x = study_year,
                                            y = cost,
                                            color = region)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  facet_wrap(~ care_type) +
  scale_x_continuous(
    breaks = seq(2008, 2018, by = 2),
    minor_breaks = 2008:2018
  ) +
  coord_cartesian(ylim = c(100, 350)) +
  scale_color_manual(values = region_colors) +
  labs(
    x = "Study Year",
    y = "",
    title = "Weekly Median Price for Center-Based Childcare ($)",
    color = "California Region"
  ) +
  theme_bw() +
  theme(
    legend.key.size = unit(0.9, "lines"),
    legend.text = element_text(size = 8),
    legend.title = element_text(size = 10),
    plot.title = element_text(size = 10),
    panel.spacing = unit(0.7, "lines")
  )
```

-   I can modify the text in my plot to be more readable

```{r}
#| label: dvs-2-ex-4
# lab 4 q 7
childcare_plot_data <- ca_childcare |>
  select(c("region", "study_year", "mfcc_infant", "mfcc_toddler", "mfcc_preschool")) |>
  pivot_longer(
    cols = starts_with("mfcc_"),
    names_to = "care_type",
    values_to = "cost"
  ) |>
  mutate(
    care_type = recode(care_type,
                       mfcc_infant = "Infant",
                       mfcc_toddler = "Toddler",
                       mfcc_preschool = "Preschool"),
    care_type = factor(care_type, levels = c("Infant", "Toddler", "Preschool")),
    region = fct_reorder2(region, study_year, cost, .desc = TRUE)
  )

region_colors <- colorRampPalette(brewer.pal(7, "Accent"))(10)

childcare_plot_data |> ggplot(mapping = aes(x = study_year,
                                            y = cost,
                                            color = region)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  facet_wrap(~ care_type) +
  scale_x_continuous(
    breaks = seq(2008, 2018, by = 2),
    minor_breaks = 2008:2018
  ) +
  coord_cartesian(ylim = c(100, 350)) +
  scale_color_manual(values = region_colors) +
  labs(
    x = "Study Year",
    y = "",
    title = "Weekly Median Price for Center-Based Childcare ($)",
    color = "California Region"
  ) +
  theme_bw() +
  theme(
    legend.key.size = unit(0.9, "lines"),
    legend.text = element_text(size = 8),
    legend.title = element_text(size = 10),
    plot.title = element_text(size = 10),
    panel.spacing = unit(0.7, "lines")
  )

```

-   I can reorder my legend to align with the colors in my plot

```{r}
#| label: dvs-2-ex-5
# lab 4 q 7
childcare_plot_data <- ca_childcare |>
  select(c("region", "study_year", "mfcc_infant", "mfcc_toddler", "mfcc_preschool")) |>
  pivot_longer(
    cols = starts_with("mfcc_"),
    names_to = "care_type",
    values_to = "cost"
  ) |>
  mutate(
    care_type = recode(care_type,
                       mfcc_infant = "Infant",
                       mfcc_toddler = "Toddler",
                       mfcc_preschool = "Preschool"),
    care_type = factor(care_type, levels = c("Infant", "Toddler", "Preschool")),
    region = fct_reorder2(region, study_year, cost, .desc = TRUE)
  )

region_colors <- colorRampPalette(brewer.pal(7, "Accent"))(10)

childcare_plot_data |> ggplot(mapping = aes(x = study_year,
                                            y = cost,
                                            color = region)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  facet_wrap(~ care_type) +
  scale_x_continuous(
    breaks = seq(2008, 2018, by = 2),
    minor_breaks = 2008:2018
  ) +
  coord_cartesian(ylim = c(100, 350)) +
  scale_color_manual(values = region_colors) +
  labs(
    x = "Study Year",
    y = "",
    title = "Weekly Median Price for Center-Based Childcare ($)",
    color = "California Region"
  ) +
  theme_bw() +
  theme(
    legend.key.size = unit(0.9, "lines"),
    legend.text = element_text(size = 8),
    legend.title = element_text(size = 10),
    plot.title = element_text(size = 10),
    panel.spacing = unit(0.7, "lines")
  )


```

**DVS-3: I show creativity in my visualizations**

-   I can use non-standard colors (Example 1)

```{r}
#| label: dvs-3-1-ex-1
## lab 4 q 7
childcare_plot_data <- ca_childcare |>
  select(c("region", "study_year", "mfcc_infant", "mfcc_toddler", "mfcc_preschool")) |>
  pivot_longer(
    cols = starts_with("mfcc_"),
    names_to = "care_type",
    values_to = "cost"
  ) |>
  mutate(
    care_type = recode(care_type,
                       mfcc_infant = "Infant",
                       mfcc_toddler = "Toddler",
                       mfcc_preschool = "Preschool"),
    care_type = factor(care_type, levels = c("Infant", "Toddler", "Preschool")),
    region = fct_reorder2(region, study_year, cost, .desc = TRUE)
  )

region_colors <- colorRampPalette(brewer.pal(7, "Accent"))(10)

childcare_plot_data |> ggplot(mapping = aes(x = study_year,
                                            y = cost,
                                            color = region)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  facet_wrap(~ care_type) +
  scale_x_continuous(
    breaks = seq(2008, 2018, by = 2),
    minor_breaks = 2008:2018
  ) +
  coord_cartesian(ylim = c(100, 350)) +
  scale_color_manual(values = region_colors) +
  labs(
    x = "Study Year",
    y = "",
    title = "Weekly Median Price for Center-Based Childcare ($)",
    color = "California Region"
  ) +
  theme_bw() +
  theme(
    legend.key.size = unit(0.9, "lines"),
    legend.text = element_text(size = 8),
    legend.title = element_text(size = 10),
    plot.title = element_text(size = 10),
    panel.spacing = unit(0.7, "lines")
  )

```

-   I can use non-standard colors (Example 2)

```{r}
#| label: dvs-3-1-ex-2
# lab 10 q 3
tab_df <- tibble(correct = results) |>
  count(correct, name = "n") |>
  mutate(proportion = n / sum(n))

ggplot(tab_df, aes(x = correct, y = proportion)) +
  geom_col(fill = "#D22B84") +
  scale_y_continuous(labels = label_percent(accuracy = 1)) +
  labs(
    x = " Correct Babies Count ",
    y = "Proportion of the Simulations",
    title = "Proportion of the Simulations by Correct Babies Count"
  ) +
  theme_minimal()
```

-   I can use annotations (e.g., `geom_text()`)

```{r}
#| label: dvs-3-2
# Lab 7 q 3
ggplot(missing_by_group, aes(x = year, y = missing_count, color = section)) +
  geom_line(size = 1) +
  geom_text(aes(label = missing_count), vjust = -0.5, size = 3) +   # annotation added
  scale_color_brewer(palette = "Set2") +
  facet_wrap(~ trip) +
  labs(
    title = "Missing Fish Weights Across Years, Sections, and Trips",
    x = "Year",
    y = "Count of Missing Weights",
    color = "Section"
  ) +
  theme_minimal()
```

-   I can choose creative geometries (e.g., `geom_segment()`, `geom_ribbon)()`)

```{r}
#| label: dvs-3-3
# Lab 10 q 13
true_beta1 <- 0.5 
ci_results |> 
  mutate(id = row_number()) |>
  ggplot(aes(x = id, ymin = conf.low, ymax = conf.high, color = factor(cover))) +
  geom_linerange() +
  geom_hline(yintercept = true_beta1, linetype = "dashed") +
  scale_color_manual(values = c("0" = "red", "1" = "blue"),
                    labels = c("0" = "Does NOT Cover", "1" = "Covers")) +
  labs(
    title = "Confidence Interval Coverage Across 1000 Simulations",
    x = "Simulation Number",
    y = "Confidence Interval for Slope",
    color = "Coverage"
  ) +
  theme_minimal()
```

**DVS-4: I can calculate numerical summaries of variables.**

-   Example using `summarize()`

```{r}
#| label: dvs-4-summarize
# Lab 4 q 5 
region_income_summary <- ca_childcare |>
  filter(study_year %in% c(2008, 2018)) |>
  group_by(region, study_year) |>
  summarize(
    median_income = median(mhi_2018, na.rm = TRUE),
    .groups = "drop"
  ) |>
  pivot_wider(
    names_from = study_year,
    values_from = median_income,
    names_glue = "median_income_{study_year}"
  ) |>
  arrange(desc(median_income_2018))
```

-   Example using `across()`

```{r}
#| label: dvs-4-across
# lab 7 q 1
missing_summary <- fish |>
  summarise(
    observations_with_missing = sum(apply(is.na(fish), 1, any)),
    across(
      .cols = everything(),
      .fns  = ~ sum(is.na(.)),
      .names = "missing_{.col}"
    )
  )
```

**DVS-5: I can find summaries of variables across multiple groups.**

-   Example 1

```{r}
#| label: dvs-5-1
# Lab 7 q 3
missing_by_group <- fish |>
  group_by(year, section, trip) |>
  summarize(
    missing_count = sum(is.na(weight)),
    .groups = "drop"
  ) |>
  mutate(trip = if_else(trip == 1, "Trip 1", "Trip 2"))
```

-   Example 2

```{r}
#| label: dvs-5-2
# Lab 3 q 10
teacher_evals_clean |> 
  filter(question_no == 901) |> 
  group_by(teacher_id) |> 
  summarise(
    avg_q1 = mean(SET_score_avg, na.rm = TRUE),
    n_courses = n_distinct(course_id),
    .groups = "drop"
  )
```

**DVS-6: I can create tables which make my summaries clear to the reader.**

-   I can modify my column names to clearly communicate the data context

```{r}
#| label: dvs-6-ex-1
# Lab 9 q 6
table_data <- evals |>
  select(academic_degree, seniority, sex) |>
  
  mutate(
    academic_degree = as.character(academic_degree),
    seniority       = as.numeric(seniority),
    sex             = as.character(sex),
    
    academic_degree = case_when(
      academic_degree == "no_dgr" ~ "No Degree",
      academic_degree == "ma"     ~ "Masters",
      academic_degree == "dr"     ~ "Doctorate",
      academic_degree == "prof"   ~ "Tenured Professor",
      TRUE ~ academic_degree
    ),
    
    seniority = case_when(
      seniority %in% c(1, 2) ~ "Junior",
      seniority %in% c(3, 4) ~ "Senior",
      seniority %in% c(5:11) ~ "Very Senior",
      TRUE ~ as.character(seniority)
    ),
    
    sex = case_when(
      sex == "female" ~ "Female",
      sex == "male"   ~ "Male",
      TRUE ~ sex
    )
  ) |>
  
  pivot_longer(
    cols = everything(),
    names_to = "Variable",
    values_to = "Level"
  ) |>
  
  count(Variable, Level, name = "Count") |>
  
  mutate(
    Percent = round(Count / sum(Count) * 100, 1),
    Percent = paste0(Percent, "%")
  ) |>
  
  arrange(Variable, Level)

table_data |>
  kbl(
    col.names = c("Variable", "Level", "Count", "%"),
    caption = "Table 1: Demographic Summary of Instructors"
  ) |>
  kable_classic(full_width = FALSE) |>
  add_header_above(c(" " = 2, "Summary Statistics" = 2)) |>
  group_rows("Academic Degree",
             1,
             sum(table_data$Variable == "academic_degree")) |>
  group_rows("Seniority",
             sum(table_data$Variable == "academic_degree") + 1,
             sum(table_data$Variable %in% c("academic_degree", "seniority"))) |>
  group_rows("Sex",
             sum(table_data$Variable %in% c("academic_degree", "seniority")) + 1,
             nrow(table_data))
```

-   I can modify the text in my table to be more readable (e.g., bold face for column headers)

```{r}
#| label: dvs-6-ex-2
## lab 4 q 7
childcare_plot_data <- ca_childcare |>
  select(c("region", "study_year", "mfcc_infant", "mfcc_toddler", "mfcc_preschool")) |>
  pivot_longer(
    cols = starts_with("mfcc_"),
    names_to = "care_type",
    values_to = "cost"
  ) |>
  mutate(
    care_type = recode(care_type,
                       mfcc_infant = "Infant",
                       mfcc_toddler = "Toddler",
                       mfcc_preschool = "Preschool"),
    care_type = factor(care_type, levels = c("Infant", "Toddler", "Preschool")),
    region = fct_reorder2(region, study_year, cost, .desc = TRUE)
  )

region_colors <- colorRampPalette(brewer.pal(7, "Accent"))(10)

childcare_plot_data |> ggplot(mapping = aes(x = study_year,
                                            y = cost,
                                            color = region)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  facet_wrap(~ care_type) +
  scale_x_continuous(
    breaks = seq(2008, 2018, by = 2),
    minor_breaks = 2008:2018
  ) +
  coord_cartesian(ylim = c(100, 350)) +
  scale_color_manual(values = region_colors) +
  labs(
    x = "Study Year",
    y = "",
    title = "Weekly Median Price for Center-Based Childcare ($)",
    color = "California Region"
  ) +
  theme_bw() +
  theme(
    legend.key.size = unit(0.9, "lines"),
    legend.text = element_text(size = 8),
    legend.title = element_text(size = 10),
    plot.title = element_text(size = 10),
    panel.spacing = unit(0.7, "lines")
  )

```

-   I can arrange my table to have an intuitive ordering

```{r}
#| label: dvs-6-ex-3
# Lab 9 q 3
data_types <- map_chr(surveys, class)

tibble(
  Variable = names(data_types),
  Data_Type = str_to_lower(data_types)   
) |>
  arrange(Data_Type) |>                
  kable(
    caption = "Table 1: Types of Data Variables in  Surveys Dataset",
    col.names = c("Variable", "Data Type"),
    align = "l"
  ) |>
  kable_styling(full_width = FALSE)
```

**DVS-7: I show creativity in my tables.**

-   I can use non-default colors

```{r}
#| label: dvs-7-ex-1
# Lab 9 q 8
gt_table <- instructor_summary |>
  gt() |>
  tab_style(
    style = list(
      cell_fill(color = "#f2f0f7") 
    ),
    locations = cells_body(
      rows = percent_failed > 20
    )
  )
```

-   I can modify the layout of my table to be more readable (e.g., `pivot_longer()` or `pivot_wider()`)

```{r}
#| label: dvs-7-ex-2
# Lab 4 q 5
region_income_summary <- ca_childcare |>
  filter(study_year %in% c(2008, 2018)) |>
  group_by(region, study_year) |>
  summarize(
    median_income = median(mhi_2018, na.rm = TRUE),
    .groups = "drop"
  ) |>
  pivot_wider(
    names_from = study_year,
    values_from = median_income,
    names_glue = "median_income_{study_year}"
  ) |>
  arrange(desc(median_income_2018))

region_income_summary
```

## Program Efficiency

**PE-1: I can write concise code which does not repeat itself.**

-   using a single function call with multiple inputs (rather than multiple function calls)

```{r}
#| label: pe-1-one-call
# Lab 9 q 2
# This works because instead of repeating class(surveys$variable), I can use map_chr() to not repeat it  
surveys |>
  map_chr(class) |>      
  enframe(name = "Variable", value = "Data Type") |> 
  kable()

```

-   using `across()`

```{r}
#| label: pe-1-across
# Lab 8 q 6
fish_scaled <- fish |>
  mutate(
    across(
      .cols = c(weight, length),
      .fns  = ~ (.-min(.))/(max(.)-min(.))
    )
  )
```

-   using functions from the `map()` family

```{r}
#| label: pe-1-map-1
# Lab 10 q 10
my_weights <- map_dbl(
  .x = 1:1000,
  .f = ~ music_man(n_tromb = 76, n_cor = 110, n_reed = 1035)
)
```

**PE-2: I can write functions to reduce repetition in my code.**

-   Example 1: Function that operates on vectors

```{r}
#| label: pe-2-1
# Lab 8 q 4
rescale_01 <- function(x) {
  (x - min(x)) / (max(x) - min(x))
}
```

-   Example 2: Function that operates on data frames

```{r}
#| label: pe-2-2
# Lab 8 q 8
pivot_table <- function(data, row_var, col_var) {
  data |>
    count({{ row_var }}, {{ col_var }}) |>
    tidyr::pivot_wider(
      names_from = {{ col_var }},
      values_from = n,
      values_fill = 0
    )
}
```

-   Example 3: Function that operates on vectors *or* data frames

```{r}
#| label: pe-2-3
# Lab 10 q 7
mycifun <- function() {
  samp <- sample(1:6, size = 30, replace = TRUE)
  tibble(
    mean_val = mean(samp),
    sd_val   = sd(samp)
  )
}
```

**PE-3:I can use iteration to reduce repetition in my code.**

-   using `across()`

```{r}
#| label: pe-3-across
# Lab 7 q 1
fish |>
  summarise(
    observations_with_missing = sum(apply(is.na(fish), 1, any)),
    across(
      .cols  = everything(),
      .fns   = ~ sum(is.na(.)),
      .names = "missing_{.col}"
    )
  )
```

-   using a `map()` function with **one** input (e.g., `map()`, `map_chr()`, `map_dbl()`, etc.)

```{r}
#| label: pe-3-map-1
# Lab 10 q 10
my_weights <- map_dbl(
  .x = 1:1000,
  .f = ~ music_man(n_tromb = 76, n_cor = 110, n_reed = 1035)
)
```

-   using a `map()` function with **more than one** input (e.g., `map_2()` or `pmap()`)

```{r}
#| label: pe-3-map-2
# Lab 10 q 10 (revised)
param_grid <- tibble(
  beta0 = rep(3, 1000),
  beta1 = rep(0.5, 1000),
  n     = rep(100, 1000)
)

ci_dat <- pmap(
  .l = param_grid,
  .f = ~ mycifun(beta0 = ..1, beta1 = ..2, n = ..3)
)
```

**PE-4: I can use modern tools when carrying out my analysis.**

-   I can use functions which are not superseded or deprecated

```{r}
#| label: pe-4-1
# Lab 10 q 8 
mycifun <- function(beta0, beta1, n) {

  x  <- runif(n, min = 0, max = 1)
  ep <- rnorm(n, mean = 0, sd = 1)
  y  <- beta0 + beta1 * x + ep
  
  obs_data <- tibble(x = x, y = y)

  fit <- lm(y ~ x, data = obs_data)

  slope_results <- tidy(fit, conf.int = TRUE)

  slope_results <- slope_results |>
    filter(term == "x") |>
    mutate(
      cover = ifelse(beta1 >= conf.low & beta1 <= conf.high, 1, 0)
    ) |>
    select(estimate, conf.low, conf.high, cover)
```

-   I can connect a data wrangling pipeline into a `ggplot()`

```{r}
#| label: pe-4-2
# Lab 7 q 3
fish |>
  group_by(year, section, trip) |>
  summarize(
    missing_count = sum(is.na(weight)),
    .groups = "drop"
  ) |>
  mutate(
    trip = if_else(trip == 1, "Trip 1", "Trip 2")
  ) |>
  ggplot(aes(x = year, y = missing_count, color = section)) +
  geom_line(size = 1) +
  facet_wrap(~ trip)
```

## Data Simulation & Statisical Models

**DSSM-1: I can simulate data from a *variety* of probability models.**

-   Example 1

```{r}
#| label: dsm-1-1
# Lab 10 q 10
ci_dat <- map(
  .x = 1:1000,
  .f = ~ mycifun(beta0 = 3, beta1 = 0.5, n = 100)
)
```

-   Example 2

```{r}
#| label: dsm-1-2
# Lab 10 q 4

intercept = 2
slope = 1

x <- runif(100, min = 0, max = 1)

ep <- rnorm(100, mean = 0, sd = 1)

y <- intercept + slope * x + ep

obs_data <- tibble(x = x, y = y)
```

**DSSM-2: I can conduct common statistical analyses in R.**

-   Example 1

```{r}
#| label: dsm-2-1
# Lab 10 Q7 
results_slope <- results_slope |>
  mutate(
    cover = ifelse(1 >= conf.low & 1 <= conf.high, 1, 0)
  )
```

-   Example 2

```{r}
#| label: dsm-2-2
# lab 2 q 17
species_mod <- aov(weight ~ species_id, data = surveys)
summary(species_mod)
```

-   Example 3

```{r}
#| label: dsm-2-3
# Lab 10 q 6
results_slope <- tidy(fit, conf.int = TRUE)
results_slope
```

## Revising My Thinking

In the course, I was always revising my final product based on feedback. I redid every lab and challenge, before turning it in I would review it and I would do the revisions. At first, I did not always add in code comments or elaborate reflections, but eventually, I built the habit of explaining what and why I had done something so it illustrated my understanding and my growth. I often times did not fully correct my code's mistakes, but over the course of this quarter I have grown greatly in my revised work's accuracy. I have been adding comments to explain how I had changed something and how the new code was clearer, more efficient, and/or more correct. I have been growing a lot as a student in this course. This was helpful for making better connections between my feedback and future assignments, and allowed me to apply lessons more intentionally.

## Extending My Thinking

I engaged in extended thinking by doing work that was above and beyond the minimum requirement of assignment and worked to apply new tools and thinking. When faced with a viewing and analyzing challenge, I often took the challenging option even when it was not only more time-consuming, but also took some research. When I could not remember how to code a solution in R, I took it upon myself to look through the documentation, trying out functions in tidyverse, and writing or referencing what I used externally. Further, I attended workshops for coding and study hours with peer tutors to help me learn better. I made an effort to write things I could understand and modify instead of simply copying someone's work. I also made it important to use only functions that made sense and ideally would be efficient. For instance, I tried to always use mutate() for transforming my data, piping (\|\>) for a readable workflow, and limit my data to only what was necessary for plotting and in relation to data being presented, using filter() and select(). I also tried to customize plots in ggplot2 and by taking into consideration communication through graphs and visualizations, such as customizing the color palette, and background, or using on of their new themes with ggplot2. Overall, I was not only trying to complete the work, but push my own development as a problem solver.

## Peer Support and Collaboration

Every Tuesday in class, we had a practise activity. For every practice activity, I was attentive and followed the rules layed out in the code for who is coding and who is talking. I always shared my ideas and let others share too. I believe for the practice activities, I excelled. I did not excell in the peer reviews, where I struggled to get the correct message across for a long time. I did not read the instructions deeply enough, therefore was not fully equip to provide the correct peer reviews. That isnt to say I didn't have some good peer reviews, focusing on the one below- for lab 10 - where I clearly outline what they should be doing better and give them some positive and constructive feedback.

Hey Connie! Overall your code is running well. I have few problems with your code, but overall a great job. For instance, you repeated the same code a couple times in questions 2 and 3 (the enframe ) Instead, you could just use a defined object for clarity and readability. Also, if you edit your code by adding some spaces in between parts (ex, in your ggplot for question 13, which has almost no breaks in the code for upwards of 20 lines) it could make reading the code for the graph simpler and more structured. Further using some more descriptive names other than “results” or “ci_data” could make it easier to read. I don't have much to say as this is a really well done code and you seem to know what you are doing! Great job Connie
